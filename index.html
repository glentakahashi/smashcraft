<!DOCTYPE html>
<html>
  <head>
    <title>Smashcraft</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="lib/jquery-2.0.0.min.js" type="text/javascript"></script>
  </head>
  <body>
    <div id="selection">
      <div id="title">
        <img src="img/smashcraft.png">
      </div>
      <table id="characterSelection">
        <tr>
          <td id="choice0" class="highlightRed"><img src="img/characters/luigiHead.png"></td>
          <td id="choice1"><img src="img/characters/marioHead.png"></td>
          <td id="choice2"><img src="img/characters/foxHead.png"></td>
          <td id="choice3"><img src="img/characters/linkHead.png"></td>
          <td id="choice4"><img src="img/characters/samusHead.png"></td>
          <td id="choice5" class="highlightBlue"><img src="img/characters/captain falconHead.png"></td>
        </tr>
        <tr>
          <td id="choice6"><img src="img/characters/thomasHead.png"></td>
          <td id="choice7"><img src="img/characters/guy-manuelHead.png"></td>
          <td id="choice8"><img src="img/characters/michael jordanHead.png"></td>
          <td id="choice9"><img src="img/characters/snoop doggHead.png"></td>
          <td id="choice10"><img src="img/characters/tronHead.png"></td>
          <td id="choice11"><img src="img/characters/psyHead.png"></td>
        </tr>
        <tr>
          <td id="choice12"><img src="img/characters/nightwingHead.png"></td>
          <td id="choice13"><img src="img/characters/robinHead.png"></td>
          <td id="choice14"><img src="img/characters/batmanHead.png"></td>
          <td id="choice15"><img src="img/characters/supermanHead.png"></td>
          <td id="choice16"><img src="img/characters/iron manHead.png"></td>
          <td id="choice17"><img src="img/characters/jon snowHead.png"></td>
        </tr>
      </table>
      <div id="players">
        <div id="player1" class="player">
          <h2>Luigi</h2>
          <img id="player1Image" class="playerImage" src="img/characters/luigiBody.png">
          <div><span class="buff">Buffs: </span><span id="player1a"></div>
          <div><span class="nerf">Nerfs: </span><span id="player1d"></div>
        </div>
        <div id="player2" class="player">
          <h2>Luigi</h2>
          <img id="player2Image" class="playerImage" src="img/characters/luigiBody.png">
          <div><span class="buff">Buffs: </span><span id="player2a"></div>
          <div><span class="nerf">Nerfs: </span><span id="player2d"></div>
        </div>
        <div id="player3" class="player" style="display:none;">
          <h2>Luigi</h2>
          <img id="player3Image" class="playerImage" src="img/characters/luigiBody.png">
          <div><span class="buff">Buffs: </span><span id="player3a"></div>
          <div><span class="nerf">Nerfs: </span><span id="player3d"></div>
        </div>
        <div id="player4" class="player" style="display:none;">
          <h2>Luigi</h2>
          <img id="player4Image" class="playerImage" src="img/characters/luigiBody.png">
          <div><span class="buff">Buffs: </span><span id="player4a"></div>
          <div><span class="nerf">Nerfs: </span><span id="player4d"></div>
        </div>
      </div>
      <div id="stageSelection">
        <div class="stage">
          <img id="image5" class="stageImage" src="img/backgrounds/grassland.jpg">
          <span class="stageNumber">5</span>
        </div>
        <div class="stage">
          <img id="image6" class="stageImage" src="img/backgrounds/jungle.jpg">
          <span class="stageNumber">6</span>
        </div>
        <div class="stage">
          <img id="image7" class="stageImage" src="img/backgrounds/nether.jpg">
          <span class="stageNumber">7</span>
        </div>
        <div class="stage">
          <img id="image8" class="stageImage" src="img/backgrounds/desert.jpg">
          <span class="stageNumber">8</span>
        </div>
        <div class="stage">
          <img id="image9" class="stageImage" src="img/backgrounds/mountains.jpg">
          <span class="stageNumber">9</span>
        </div>
        <div class="stage">
          <img id="image0" class="stageImage" src="img/backgrounds/ocean.jpg">
          <span class="stageNumber">0</span>
        </div>
      </div>
      <div id="instructions">
        <h3>Instructions</h3>
        <p>Press 2, 3, or 4 to change the number of players</p>
        <p>Press 5, 6, 7, 8, 9, or 0 to start the game on the corresponding stage</p>
        <p>Press Escape to go back to the character selection screen</p>
        <b>Player 1 Controls</b><br>
        WASD for movement<br>
        Q for punch attack<br>
        E for kick attack<br>
        Z for dodge<br><br>
        <b>Player 2 Controls</b><br>
        Arrow Keys for movement<br>
        Right Shift for punch attack<br>
        Enter Key for kick attack<br>
        . for dodge<br><br>
        <b>Player 3 Controls</b><br>
        YGHJ for movement<br>
        T for punch attack<br>
        U for kick attack<br>
        V for dodge<br><br>
        <b>Player 4 Controls</b><br>
        PL;' for movement<br>
        O for punch attack<br>
        [ for kick attack<br>
        ] for dodge<br><br>
      </div>
    </div>

    <div id="game" style="display:none;">
      <div id="winner"></div>
      <canvas id="canvas" width="1000"></canvas>
      <div id="hud">
        <div id="p1">
          <div class="name"></div>
          <div class="damage">
            <span id="player1hp"></span>%
          </div>
        </div>
        <div id="p2">
          <div class="name"></div>
          <div class="damage">
            <span id="player2hp"></span>%
          </div>
        </div>
        <div id="p3" style="display: none;">
          <div class="name"></div>
          <div class="damage">
            <span id="player3hp"></span>%
          </div>
        </div>
        <div id="p4" style="display: none;">
          <div class="name"></div>
          <div class="damage">
            <span id="player4hp"></span>%
          </div>
        </div>
      </div>
    </div>

  </body>
  <script src="selection.js" type="text/javascript"></script>

  <!-- Shaders -->
  <script id="vertex-shader" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec3 aVertexNormal;
    attribute vec3 aVertexTangent;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;
    uniform mat4 uCMatrix;
    uniform mat3 uNMatrix;

    varying vec2 vTextureCoord;
    varying vec4 vPositionV;
    varying vec3 vNormalV;
    varying vec3 vTangentV;

    uniform bool useNormalMap;
    
    void main(void) {
      vec4 mvPos = uMVMatrix * vec4(aVertexPosition, 1.0);
      gl_Position = uPMatrix * uCMatrix * mvPos;
      vPositionV = mvPos;
      vNormalV = (uMVMatrix * vec4(aVertexNormal, 0.0)).xyz;
      vTangentV = (uMVMatrix * vec4(aVertexTangent, 0.0)).xyz;
      vTextureCoord = aTextureCoord;
    }

  </script>

  <script id="fragment-shader" type="x-shader/x-fragment">
    precision mediump float;

    // Texture samplers
    uniform sampler2D uSampler;
    uniform sampler2D uNormalSampler;
    
    uniform vec3 uAmbientColor;
    uniform vec3 uPointLightingLocation;
    uniform vec3 uPointLightingColor;

    uniform bool stun;
    uniform bool useNormalMap;

    varying vec2 vTextureCoord;
    varying vec4 vPositionV;
    varying vec3 vNormalV;
    varying vec3 vTangentV;

    void main(void) {
      vec3 diffuse;
      if (stun)
        diffuse = vec3(1.0, 1.0, 1.0);
      else
        diffuse = texture2D(uSampler, vTextureCoord).rgb;

      vec3 normalV;
      if (useNormalMap) {
        vec3 normalT = texture2D(uNormalSampler, vTextureCoord).xyz;
        normalT.y = 1.0 - normalT.y;
        normalT = 2.0 * normalT - vec3(1.0, 1.0, 1.0);
        normalT.z *= 10.0;
        vec3 binormalV = cross(vNormalV, vTangentV);
        normalV = normalT.x * vTangentV + normalT.y * binormalV + normalT.z * vNormalV;
      }
      else {
        normalV = vNormalV;
      }
      
      normalV = normalize(normalV);
      vec3 lightV = normalize(vPositionV.xyz - uPointLightingLocation);
      
      float d = dot(normalV, lightV);
      float s = dot(reflect(-lightV, normalV), normalize(-vPositionV.xyz));
      s = pow(s, 30.0);
      float a = 0.6;
      
      vec3 color = diffuse * (0.5 * d + 0.9 * s + a);
    
      gl_FragColor = vec4(color, 1.0);
    }
  </script>

  <!-- Libraries -->
  <script src="lib/gl-matrix-min.js" type="text/javascript"></script>
  <script src="lib/webgl-utils.js" type="text/javascript"></script>

  <!-- Game Data & Utility -->
  <script src="constants.js" type="text/javascript"></script>
  <script src="util.js" type="text/javascript"></script>
  <script src="audio.js" type="text/javascript"></script>

  <!-- Classes -->
  <script src="controller.js" type="text/javascript"></script>
  <script src="stack.js" type="text/javascript"></script>
  <script src="camera.js" type="text/javascript"></script>
  <script src="game.js" type="text/javascript"></script>
  <script src="platform.js" type="text/javascript"></script>
  <script src="player.js" type="text/javascript"></script>
  <script src="player-model.js" type="text/javascript"></script>
  <script src="platform-model.js" type="text/javascript"></script>
  <script src="model.js" type="text/javascript"></script>
  <script type="text/javascript">
    // Globals
    audio = new Audio();
    mvstack = new MatrixStack();
    gl = null;
    program = null;
    textures = {};

    // Global matrices
    modelView = null;
    
    var game;
    var gameOverTime=0;
    var reset=false;
    var isAlive=0;

    // Tick happens after texture is loaded
    // TODO: make it less shitty, especially with multiple textures
    //game.tick();
  </script>


</html>
