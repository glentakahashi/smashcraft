<!DOCTYPE html>
<html>
  <head>
    <title>Smashcraft</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body style="padding: 0; margin: 0;">

    <canvas id="canvas" width="800" height="500"></canvas>
    <div id="hud">
      Guy-Man HP: <span id="guyman"></span><br>
      Thomas HP: <span id="thomas"></span>
    </div>

  </body>

  <!-- Shaders -->
  <script id="vertex-shader" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec3 aVertexNormal;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;
    uniform mat4 uCMatrix;
    uniform mat3 uNMatrix;

    varying vec2 vTextureCoord;
    varying vec3 vTransformedNormal;
    varying vec4 vPosition;

    void main(void) {
      vPosition = uMVMatrix * vec4(aVertexPosition, 1.0);
      gl_Position = uPMatrix * uCMatrix * vPosition;
      vTextureCoord = aTextureCoord;
      vTransformedNormal = uNMatrix * aVertexNormal;
    }
  </script>

  <script id="fragment-shader" type="x-shader/x-fragment">
    precision mediump float;

    varying vec2 vTextureCoord;
    varying vec3 vTransformedNormal;
    varying vec4 vPosition;

    uniform vec3 uAmbientColor;
    uniform vec3 uPointLightingLocation;
    uniform vec3 uPointLightingColor;

    uniform sampler2D uSampler;

    void main(void) {
      vec3 lightWeighting;
      vec3 lightDirection = normalize(uPointLightingLocation - vPosition.xyz);
      float directionalLightWeighting = max(dot(normalize(vTransformedNormal), lightDirection), 0.0);
      lightWeighting = uAmbientColor + uPointLightingColor * directionalLightWeighting;
      vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
      gl_FragColor = vec4(textureColor.rgb*lightWeighting, textureColor.a);
      
    }
  </script>

  <!-- Libraries -->
  <script src="lib/jquery-2.0.0.min.js" type="text/javascript"></script>
  <script src="lib/gl-matrix-min.js" type="text/javascript"></script>
  <script src="lib/webgl-utils.js" type="text/javascript"></script>

  <!-- Game Data & Utility -->
  <script src="constants.js" type="text/javascript"></script>
  <script src="util.js" type="text/javascript"></script>

  <!-- Classes -->
  <script src="controller.js" type="text/javascript"></script>
  <script src="stack.js" type="text/javascript"></script>
  <script src="game.js" type="text/javascript"></script>
  <script src="platform.js" type="text/javascript"></script>
  <script src="player.js" type="text/javascript"></script>
  <script src="model.js" type="text/javascript"></script>
  <script type="text/javascript">
    // Globals
    mvstack = new MatrixStack();
    gl = null;
    program = null;
    textures = {};

    // Global matrices
    camera = null;
    modelView = null;
    perspective = null;

    var game = new Game();
    game.init();
    // Tick happens after texture is loaded
    // TODO: make it less shitty, especially with multiple textures
    //game.tick();
  </script>


</html>
